前提
犯罪のカテゴリ
小型強盗：コンビニ強盗、フリーカ強盗、ブースティング強盗、ATM強盗、空き巣強盗、モーテル強盗
中型強盗：ボブキャット強盗、空港強盗、コンテナ強盗、トレイン強盗、客船強盗、オイルリグ強盗
大型強盗：ユニオン強盗、アーティファクト強盗
中型以上：中型＋大型

各シートの構成
シート1
名前｜ID｜ロールの所持
シート2
日付｜犯罪の種類｜犯罪のカテゴリ｜参加者のID｜検挙｜ギャングの色
シート3
名前｜金額
シート4
名前｜ID｜小型対応件数｜小型検挙数｜中型以上対応件数｜中型以上検挙数｜チケット枚数
シート5
名前｜ID｜小型対応件数｜小型検挙数｜中型以上対応件数｜中型以上検挙数｜チケット枚数
シート6
犯罪の種類｜犯罪のカテゴリ｜対応件数｜⚪｜⚫｜🔴｜🔵｜🟣｜🟡｜🟠｜🩷｜全体勝率


起動時にシート1のID上から順に discordで検索して現在のサーバーニックネームに更新する。
ロールID(1231945357936689182)を持っているかを確認し、持っていたら⭕、持っていなかったら❌をシート1に記録する。

処理が終わったら準備完了とconsoleに出力する。

!search yyyy/mm/dd yyyy/mm/dd
“処理開始”とdiscordに出力する。
1309142327062954005(検挙メモのチャンネルID)と1342103011396288512(小型用検挙メモのチャンネルID)から期間内のデータ(日付、犯罪の種類、犯罪カテゴリ、参加者のID、検挙、色)を検出し、シート2に記録を追加する。
日付：メッセージが投稿された時間から取得
犯罪の種類：メッセージに該当する単語が含まれていれば特定する。無ければ無視する。
コンビニ強盗：”コンビニ”
フリーカ強盗：”フリーカ”
ブースティング強盗：”ブースティング”
ATM強盗：”ATM”
空き巣強盗：”空き巣”
モーテル強盗：”モーテル”
ボブキャット強盗：”ボブキャット”
空港強盗：”空港”
コンテナ強盗：”コンテナ”
トレイン強盗：”トレイン”、”列車”
客船強盗：”客船”
オイルリグ強盗：”オイルリグ”
ユニオン強盗：”ユニオン”
アーティファクト強盗：”アーティファクト”
犯罪カテゴリ：前提の区分から特定する。
参加者のID：✅のリアクションをした人のdiscordIDを取得する。参加者のIDがシート1になかったときシート1に名前とIDを追加する。
検挙：⭕❌のリアクションをそのまま記録する。
色：⚪⚫🔴🔵🟣🟡🟠🩷リアクションをそのまま記録する。複数ある場合も記録する。
“処理終了”とdiscordに出力する。

!count yyyy/mm/dd yyyy/mm/dd
“処理開始”とdiscordに出力する。
シート4の1行目以外をクリア🗑️する。
シート1、2から期間内の個人データ(名前、ID、小型対応件数、小型検挙数、中型以上対応件数、中型以上検挙数)を検出し、シート4に記録をする。
名前：シート1から取得
ID：シート2から取得
小型対応件数：シート2から小型強盗の参加回数をカウント
小型検挙数：シート2から参加した小型強盗の⭕の数だけをカウント
中型以上対応件数：シート2から中型強盗と大型強盗の参加回数をカウント
中型以上検挙数：シート2から中型強盗と大型強盗の⭕の数だけをカウント
“処理終了”とdiscordに出力する。

!add
“処理開始”とdiscordに出力する。
シート4のデータ(同じIDのデータ)をシート5に加算する。（C列～F列）
同じIDが無ければ新しくシート5に追加する。
名前とIDをシート1と同じにする。
名前（A列）と対応件数（C列～F列）をdiscordに出力する
discordに出力する
小型検挙100件、中型以上検挙50件を超えた場合に通知
“処理終了”とdiscordに出力する。

!rate yyyy/mm/dd yyyy/mm/dd
“処理開始”とdiscordに出力する。
シート2から
期間内の各犯罪の勝率と各色との勝率を計算し、シート6に記録する。
犯罪の種類、犯罪のカテゴリ、対応件数、⚪、⚫、🔴、🔵、🟣、🟡、🟠、🩷、全体勝率
“処理終了”とdiscordに出力する。

!calculate yyyy/mm/dd yyyy/mm/dd
“処理開始”とdiscordに出力する。
シート2から期間内の小型犯罪のみの対応数で手当を支給する。
検挙は1500000円、未検挙は1000000円とする。
結果(名前、金額)をシート3に記録する。
記録したデータを1行ずつ discordに出力する。
“処理終了”とdiscordに出力する。

!clear (yyyy/mm/dd)
“処理開始”とdiscordに出力する。
コマンドを入力したチャンネルのリアクションのないメッセージを全て削除する。
期間が指定されていた場合はその日のみのメッセージを削除する。
“処理終了”とdiscordに出力する。

!ticket
“処理開始”とdiscordに出力する。
シート4の小型対応件数が20回ごとに1枚、中型以上対応件数が10回ごとに1枚付与する。ただし、端数は切り捨てる。
チケット獲得者のみdiscordに1行ずつ出力する。
“処理終了”とdiscordに出力する。


Bot起動
  │
  ├─ on_ready
  │    ├─ ギルド取得
  │    ├─ シート1既存データ取得
  │    ├─ ユーザーID→行辞書化
  │    ├─ メンバー情報更新
  │    └─ シート1更新
  │
  ├─ !search start_date end_date
  │    ├─ 開始・終了日時設定（JST）
  │    ├─ シート1既存ユーザー取得
  │    ├─ 犯罪名マッピング
  │    ├─ 各チャンネルのメッセージ履歴取得
  │    │    ├─ メッセージから犯罪名判定
  │    │    ├─ カテゴリ判定
  │    │    ├─ リアクション解析
  │    │    │    ├─ ✅ → 参加者
  │    │    │    ├─ ⭕/❌ → 検挙
  │    │    │    └─ ギャング色
  │    │    └─ シート2に追記
  │    └─ シート1更新（名前・PDロール）
  │
  ├─ !count [user_id] start_date end_date
  │    ├─ 引数解析
  │    ├─ シート1からユーザーID→名前マップ作成
  │    ├─ シート4初期化
  │    ├─ シート2から対象期間のデータ取得
  │    ├─ 集計
  │    │    ├─ 小型強盗 → 対応件数/検挙数
  │    │    └─ 中型以上 → 対応件数/検挙数
  │    └─ シート4に書き込み
  │
  ├─ !add
  │    ├─ シート4/シート5取得
  │    ├─ シート5既存データ辞書化
  │    ├─ シート4データをシート5に加算
  │    ├─ 更新行作成（チケット列は0固定）
  │    ├─ シート5更新
  │    └─ Discordに出力
  │          ├─ 1メッセージ1900文字以内で分割
  │          └─ 小型100件・中型50件超え通知
  │
  ├─ !rate start_date end_date
  │    ├─ 対象期間のシート2データ取得
  │    ├─ カテゴリ判定
  │    ├─ 犯罪・ギャング色別集計
  │    └─ シート6に書き込み
  │
  ├─ !calculate start_date end_date
  │    ├─ シート3初期化
  │    ├─ シート2データ取得
  │    ├─ 日付判定・小型強盗フィルター
  │    ├─ 参加者ごとの報酬計算
  │    ├─ シート3に記録
  │    └─ Discordに出力（総額含む）
  │
  ├─ !clear [yyyy/mm/dd]
  │    ├─ 引数なし → 全期間
  │    └─ 引数あり → 指定日
  │          ├─ メッセージ取得
  │          ├─ リアクションなしフィルター
  │          └─ purge
  │
  └─ !ticket
       ├─ シート4取得
       ├─ 小型20回ごと/中型10回ごとでチケット計算
       ├─ シート4更新
       └─ Discordに通知


